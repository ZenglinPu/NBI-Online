{"ast":null,"code":"export default {\n  name: \"P_UserCenter\",\n\n  data() {\n    return {\n      isLogin: true,\n      uname: \"\",\n      uid: this.getUID(),\n      rank: 1,\n      registerTime: \"\",\n      workPlace: \"\",\n      department: \"\",\n      competent: \"\",\n      leftTimes: \"\",\n      totalTimes: \"\",\n      expiresTime: \"\",\n      inviteCode: \"\",\n      isChangeUName: false,\n      isChangeAdditionInfo: false,\n      isChangePWD: false,\n      pwdForm: {\n        oldPwd: \"\",\n        newPwd: \"\",\n        checkPwd: \"\"\n      }\n    };\n  },\n\n  computed: {\n    headerIconSrc() {\n      if (this.rank === 1) {\n        return \"/static/img/normalUser.png\";\n      } else {\n        return \"/static/img/superUser.png\";\n      }\n    },\n\n    headerFont() {\n      if (this.rank === 1) {\n        return \"headerNormalFont\";\n      } else {\n        return \"headerSuperFont\";\n      }\n    }\n\n  },\n\n  mounted() {\n    this.getUserCenterInfo();\n  },\n\n  methods: {\n    getCookie(objName) {\n      //获取指定名称的cookie的值\n      const arrStr = document.cookie.split(\"; \");\n\n      for (let i = 0; i < arrStr.length; i++) {\n        const temp = arrStr[i].split(\"=\");\n        if (temp[0] === objName) return temp[1];\n      }\n\n      return null;\n    },\n\n    getToken() {\n      return this.getCookie(\"NBI_token\");\n    },\n\n    getUID() {\n      return this.getCookie(\"NBI_UID\");\n    },\n\n    submitForm() {\n      if (this.pwdForm.newPwd === \"\" || this.pwdForm.checkPwd === \"\" || this.pwdForm.oldPwd === \"\") {\n        this.$message({\n          showClose: true,\n          message: '您必须输入原密码和新密码',\n          type: 'error'\n        });\n        return;\n      }\n\n      if (this.pwdForm.newPwd !== this.pwdForm.checkPwd) {\n        this.$message({\n          showClose: true,\n          message: '您前后输入的新密码不一致',\n          type: 'error'\n        });\n        return;\n      }\n\n      let changePwdForm = new FormData();\n      changePwdForm.append(\"token\", this.getToken());\n      changePwdForm.append(\"uid\", this.getUID());\n      changePwdForm.append(\"oldPwd\", this.pwdForm.oldPwd);\n      changePwdForm.append(\"newPwd\", this.pwdForm.newPwd);\n      this.$axios.post(\"/NBI/User/uploadNewPwd/\", changePwdForm, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      }).then(response => {\n        if (response.data === 1) {\n          this.$message({\n            showClose: true,\n            message: '您的账号状态错误！',\n            type: 'error'\n          });\n        } else if (response.data === 2) {\n          this.$message({\n            showClose: true,\n            message: '原始密码错误，修改失败！',\n            type: 'error'\n          });\n          this.resetForm();\n        } else if (response.data === 3) {\n          this.$message({\n            showClose: true,\n            message: '新密码设置成功',\n            type: 'success'\n          });\n          this.isChangePWD = false;\n          this.resetForm();\n        }\n      });\n    },\n\n    resetForm() {\n      this.pwdForm.oldPwd = \"\";\n      this.pwdForm.newPwd = \"\";\n      this.pwdForm.checkPwd = \"\";\n      this.$refs.pwdForm.clearValidate();\n    },\n\n    inputInviteCode() {\n      // 可以反复赠送的问题还没有解决\n      let inviteCodeForm = new FormData();\n      inviteCodeForm.append(\"token\", this.getToken());\n      inviteCodeForm.append(\"uid\", this.getUID());\n      inviteCodeForm.append(\"inviteCode\", this.$refs.othersInviteCode.value);\n      this.$axios.post(\"/NBI/User/inputInviteCode/\", inviteCodeForm, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      }).then(response => {\n        if (response.data === 1) {\n          this.$message({\n            showClose: true,\n            message: '邀请码激活成功！已经为对方增加30天超级用户权限！',\n            type: 'success'\n          });\n        } else if (response.data === -1) {\n          this.$message({\n            showClose: true,\n            message: '您已注册超过24小时，不能赠送',\n            type: 'error'\n          });\n        } else if (response.data === -2) {\n          this.$message({\n            showClose: true,\n            message: '找不到目标用户，请检查您的邀请码是否正确',\n            type: 'error'\n          });\n        } else if (response.data === -3) {\n          this.$message({\n            showClose: true,\n            message: '不能给自己赠送哦',\n            type: 'error'\n          });\n        } else if (response.data === -4) {\n          this.$message({\n            showClose: true,\n            message: '您已经激活过了，一个账号仅可一次赠送，但可以多次接受赠送',\n            type: 'error'\n          });\n        }\n      });\n    },\n\n    uploadNewUName() {\n      this.isChangeUName = false;\n      let changeUnameForm = new FormData();\n      changeUnameForm.append(\"token\", this.getToken());\n      changeUnameForm.append(\"uid\", this.getUID());\n      this.uname = document.getElementById(\"newUName\").value;\n      changeUnameForm.append(\"name\", this.uname);\n      this.$axios.post(\"/NBI/User/uploadNewUName/\", changeUnameForm, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      }).then(response => {\n        if (response.data === 1) {\n          this.$message({\n            showClose: true,\n            message: '您的账号状态错误！',\n            type: 'error'\n          });\n        } else {\n          this.$message({\n            showClose: true,\n            message: '修改用户名成功！',\n            type: 'success'\n          });\n          this.$bus.$emit('changeStatus', {\n            status: true,\n            uname: this.uname\n          });\n        }\n      });\n    },\n\n    uploadNewAdditionalInfo() {\n      this.isChangeAdditionInfo = false;\n      let newAddInfo = new FormData();\n      newAddInfo.append(\"token\", this.getToken());\n      newAddInfo.append(\"uid\", this.getUID());\n      newAddInfo.append(\"workPlace\", this.$refs.workPlaceInput.value);\n      newAddInfo.append(\"department\", this.$refs.departmentInput.value);\n      newAddInfo.append(\"competent\", this.$refs.competentInput.value);\n      this.$axios.post(\"/NBI/User/uploadNewAddInfo/\", newAddInfo, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      }).then(response => {\n        if (response.data === 1) {\n          this.$message({\n            showClose: true,\n            message: '您的账号状态错误！',\n            type: 'error'\n          });\n        } else {\n          this.$message({\n            showClose: true,\n            message: '修改附加信息成功！',\n            type: 'success'\n          });\n          this.workPlace = response.data.workPlace;\n          this.department = response.data.department;\n          this.competent = response.data.competent;\n        }\n      });\n    },\n\n    getUserCenterInfo() {\n      let getUserInfoForm = new FormData();\n      getUserInfoForm.append(\"token\", this.getToken());\n      getUserInfoForm.append(\"uid\", this.getUID());\n      let config = {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      };\n      this.$axios.post(\"/NBI/User/getUserInfo/\", getUserInfoForm, config).then(response => {\n        // console.log(response)\n        if (response.data === 1) {\n          this.isLogin = false;\n          this.$message({\n            showClose: true,\n            message: '没有找到您的用户信息，您可能是没有登录或通信不畅',\n            type: 'error'\n          });\n        } else {\n          this.isLogin = true;\n          this.uname = response.data.name;\n          this.rank = response.data.rank;\n          this.registerTime = response.data.registerTime;\n          this.workPlace = response.data.workPlace;\n          this.department = response.data.department;\n          this.competent = response.data.competent;\n          this.leftTimes = response.data.TIMES_generate;\n          this.totalTimes = response.data.SUM_generate;\n          this.expiresTime = response.data.expiresTime;\n          this.inviteCode = response.data.inviteCode;\n        }\n      });\n    },\n\n    userLogOut() {\n      // 注销\n      let logoutForm = new FormData();\n      logoutForm.append(\"token\", this.getToken());\n      logoutForm.append(\"uid\", this.getUID());\n      this.$axios.post(\"/NBI/User/logout/\", logoutForm, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      }).then(response => {\n        console.log(response);\n\n        if (response.data === 1) {\n          this.$message({\n            showClose: true,\n            message: '注销失败，您的账号状态错误！',\n            type: 'error'\n          });\n        } else if (response.data === 2) {\n          this.$message({\n            showClose: true,\n            message: '您已注销',\n            type: 'warning'\n          });\n          this.isLogin = false;\n          this.$bus.$emit('changeStatus', {\n            status: false,\n            uname: \"\"\n          });\n        }\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["name","data","isLogin","uname","uid","rank","registerTime","workPlace","department","competent","leftTimes","totalTimes","expiresTime","inviteCode","isChangeUName","isChangeAdditionInfo","isChangePWD","pwdForm","oldPwd","newPwd","checkPwd","computed","headerIconSrc","headerFont","mounted","methods","getCookie","getToken","getUID","submitForm","showClose","message","type","changePwdForm","headers","then","response","resetForm","inputInviteCode","inviteCodeForm","uploadNewUName","changeUnameForm","status","uploadNewAdditionalInfo","newAddInfo","getUserCenterInfo","getUserInfoForm","userLogOut","logoutForm","console"],"sourceRoot":"src/components/userCenterPage","sources":["UserCenter.vue"],"sourcesContent":["<template>\r\n  <div id=\"userCenterPageContainer\">\r\n    <div v-show=\"isLogin\" id=\"userCenterInner\">\r\n      <div id=\"userCenterHeader\">\r\n        <div style=\"width: 15%;height: 70%;display: flex;justify-content: center;align-items: center;\">\r\n          <img :src=\"headerIconSrc\" id=\"userCenterHeader_icon\" alt=\"加载失败\">\r\n        </div>\r\n        <div style=\"width: 25%;height: 70%;display: flex;flex-direction: column;justify-content: center;align-items: start\">\r\n          <div style=\"width: 100%;height: 60%; display: flex;justify-content: start;align-items: center;\">\r\n            <p v-show=\"!isChangeUName\" id=\"headerNameFont\">{{uname}}</p>\r\n            <el-tooltip v-show=\"isChangeUName\" class=\"item\" effect=\"dark\" content=\"输入后按Enter键确认，最大长度为10个字符。\" placement=\"top\">\r\n              <input maxlength=\"10\" id=\"newUName\" type=\"text\" :value=\"uname\" @blur=\"isChangeUName = false\" @keyup.enter=\"uploadNewUName()\" style=\"height: 68%;width: 90%;border-radius: 4px;border: 1px #0b007e solid;\"/>\r\n            </el-tooltip>\r\n            <div @click=\"isChangeUName = true\" class=\"el-icon-edit changeBtn\"></div>\r\n          </div>\r\n          <div style=\"width: 100%;height: 35%; display: flex;justify-content: start;align-items: center;\" :class=\"headerFont\">\r\n            <p>欢迎：{{rank===1?'普通':'尊贵的超级'}}用户</p>\r\n            <el-popover\r\n              placement=\"top-start\"\r\n              width=\"100\"\r\n              title=\"用户等级\"\r\n              trigger=\"hover\"\r\n              content=\"超级用户可以无限次生成/保存图片，且享有快速处理通道。\">\r\n              <el-button style=\"cursor: help;margin-left: 20px;margin-right: 10px;\" size=\"small\" slot=\"reference\" icon=\"el-icon-link\" circle></el-button>\r\n            </el-popover>\r\n          </div>\r\n        </div>\r\n        <div style=\"width: 60%;height: 70%;display: flex;flex-direction: row;justify-content: end; align-items: center\">\r\n          <div @click=\"isChangePWD = true\" id=\"changePWDBtn\" title=\"注销\"><p>Change Password</p></div>\r\n          <div @click=\"userLogOut()\" id=\"logOutBtn\" title=\"注销\"><p>Sign Out</p></div>\r\n        </div>\r\n        <el-drawer\r\n          title=\"修改密码\"\r\n          :visible.sync=\"isChangePWD\"\r\n          direction=\"ltr\"\r\n          >\r\n          <div style=\"height: 80%;width: 90%;\">\r\n            <el-form ref=\"pwdForm\" label-width=\"100px\" class=\"demo-ruleForm\">\r\n              <el-form-item label=\"原密码\" prop=\"oldPwd\">\r\n                <el-input type=\"password\" v-model=\"pwdForm.oldPwd\" autocomplete=\"off\" show-password></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"新密码\" prop=\"newPwd\">\r\n                <el-input type=\"password\" v-model=\"pwdForm.newPwd\" autocomplete=\"off\" show-password></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"确认密码\" prop=\"checkPwd\">\r\n                <el-input type=\"password\" v-model=\"pwdForm.checkPwd\" autocomplete=\"off\" show-password></el-input>\r\n              </el-form-item>\r\n              <el-form-item>\r\n                <el-button type=\"primary\" @click=\"submitForm()\">提交</el-button>\r\n                <el-button @click=\"resetForm()\">重置</el-button>\r\n              </el-form-item>\r\n            </el-form>\r\n          </div>\r\n        </el-drawer>\r\n      </div>\r\n      <div id=\"userCenterInfo\">\r\n        <div style=\"border-bottom: 1px #0b007e solid;width: 100%;height: 29%;display: flex;flex-direction: row;align-items: center;justify-content: center;\">\r\n          <div class=\"infoTitle\">\r\n            <p>注册信息</p>\r\n          </div>\r\n          <div class=\"infoContent\">\r\n            <div style=\"border: 1px solid gray;border-right: none;width:100%;height: 50%;display: flex; flex-direction: row;justify-content: start; align-items: center;\">\r\n              &emsp;&emsp;注册邮箱:&emsp;{{uid}}\r\n            </div>\r\n            <div style=\"border: 1px solid gray;border-right: none;width:100%;height: 50%;display: flex; flex-direction: row;justify-content: start; align-items: center;\">\r\n              &emsp;&emsp;注册时间:&emsp;{{registerTime}}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div style=\"border-bottom: 1px #0b007e solid;width: 100%;height: 29%;display: flex;flex-direction: row;align-items: center;justify-content: center;\">\r\n          <div class=\"infoTitle\">\r\n            <p>附加信息</p>\r\n            <el-button @click=\"isChangeAdditionInfo = true\" v-show=\"!isChangeAdditionInfo\" icon=\"el-icon-edit\" style=\"font-size: small;height: 20%;width: 20%;margin-left: 10px;display: flex;justify-content: center;align-items: center\">修改</el-button>\r\n            <el-button @click=\"uploadNewAdditionalInfo()\" v-show=\"isChangeAdditionInfo\" icon=\"el-icon-folder-checked\" style=\"font-size: small;height: 20%;width: 20%;margin-left: 10px;display: flex;justify-content: center;align-items: center\">保存</el-button>\r\n          </div>\r\n          <div class=\"infoContent\">\r\n            <div style=\"border: 1px solid gray;border-right: none;width:100%;height: 50%;display: flex; flex-direction: row;justify-content: start; align-items: center;\">\r\n              <div style=\"width:50%;height: 100%;display: flex; flex-direction: row;justify-content: start; align-items: center;\">\r\n                &emsp;&emsp;工作单位:&emsp;\r\n                <p v-show=\"!isChangeAdditionInfo\">\r\n                  {{workPlace}}\r\n                </p>\r\n                <input type=\"text\" @keyup.enter=\"uploadNewAdditionalInfo()\" v-show=\"isChangeAdditionInfo\" ref=\"workPlaceInput\" :value=\"workPlace\" style=\"height: 55%;width: 55%;border-radius: 4px;border: 1px #0b007e solid;\"/>\r\n              </div>\r\n              <div style=\"border: 1px solid gray;border-right: none;width:50%;height: 100%;display: flex; flex-direction: row;justify-content: start; align-items: center;\">\r\n                &emsp;&emsp;工作部门:&emsp;\r\n                <p v-show=\"!isChangeAdditionInfo\">\r\n                  {{department}}\r\n                </p>\r\n                <input type=\"text\" @keyup.enter=\"uploadNewAdditionalInfo()\" v-show=\"isChangeAdditionInfo\" ref=\"departmentInput\" :value=\"department\" style=\"height: 55%;width: 55%;border-radius: 4px;border: 1px #0b007e solid;\"/>\r\n              </div>\r\n            </div>\r\n            <div style=\"border: 1px solid gray;border-right: none;width:100%;height: 50%;display: flex; flex-direction: row;justify-content: start; align-items: center;\">\r\n              <div style=\"border-right: 1px solid gray;width:50%;height: 100%;display: flex; flex-direction: row;justify-content: start; align-items: center;\">\r\n                &emsp;&emsp;当前职称:&emsp;\r\n                <p v-show=\"!isChangeAdditionInfo\">\r\n                  {{competent}}\r\n                </p>\r\n                <input type=\"text\" @keyup.enter=\"uploadNewAdditionalInfo()\" v-show=\"isChangeAdditionInfo\" ref=\"competentInput\" :value=\"competent\" style=\"height: 55%;width: 55%;border-radius: 4px;border: 1px #0b007e solid;\"/>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div style=\"border-bottom: 1px #0b007e solid;width: 100%;height: 30%;display: flex;flex-direction: row;align-items: center;justify-content: center;\">\r\n          <div class=\"infoTitle\">\r\n            <p>NBI相关信息</p>\r\n          </div>\r\n          <div class=\"infoContent\">\r\n            <div style=\"border: 1px solid gray;border-right: none;width:100%;height: 50%;display: flex; flex-direction: row;justify-content: start; align-items: center;\">\r\n              <div style=\"height: 100%;width: 30%;display: flex;flex-direction: column;justify-content: start;align-items: center\">\r\n                <div style=\"height: 40%;width: 100%;margin: 0\">\r\n                  <p>&emsp;&emsp;用户等级:&emsp;{{rank===1?'普通':'超级'}}用户</p>\r\n                </div>\r\n                <div style=\"height: 20%;width: 100%;margin: 0\">\r\n                  <p style=\"height: 20%;font-size: small;font-family: 幼圆,serif;color: #0b007e\" v-show=\"rank===2\">&emsp;&emsp;过期时间:&emsp;{{expiresTime}}</p>\r\n                </div>\r\n              </div>\r\n              <div style=\"height: 100%;width: 20%;display: flex;justify-content: center;align-items: center\">\r\n                <p class=\"fontLink\">\r\n                  超级用户有什么用？\r\n                </p>\r\n              </div>\r\n              <div style=\"height: 100%;width: 20%;display: flex;justify-content: center;align-items: center\">\r\n                <p class=\"fontLink\">\r\n                  如何成为超级用户？\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div style=\"border: 1px solid gray;border-right: none;width:100%;height: 50%;display: flex; flex-direction: row;justify-content: start; align-items: center;\">\r\n              <div style=\"width:50%;height: 100%;display: flex; flex-direction: row;justify-content: start; align-items: center;\">\r\n                &emsp;&emsp;剩余次数:&emsp;\r\n                {{leftTimes===-1?'不限':leftTimes}}\r\n              </div>\r\n              <div style=\"border: 1px solid gray;border-right: none;width:50%;height: 100%;display: flex; flex-direction: row;justify-content: start; align-items: center;\">\r\n                &emsp;&emsp;总共生成次数:&emsp;\r\n                {{totalTimes}}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div style=\"border-bottom: 1px #0b007e solid;width: 100%;height: 12%;display: flex;flex-direction: row;align-items: center;justify-content: center;\">\r\n          <div class=\"infoTitle\">\r\n            <p>邀请码</p>\r\n            <el-popover\r\n              placement=\"top-start\"\r\n              width=\"100\"\r\n              title=\"邀请码\"\r\n              trigger=\"hover\"\r\n              content=\"新用户注册当天内输入对方邀请码即可为对方增加30天超级用户权限！（每人仅限一次赠送机会，但是可以多次接收）\">\r\n              <el-button style=\"cursor: help;margin-left: 20px;margin-right: 10px;\" size=\"small\" slot=\"reference\" icon=\"el-icon-link\" circle></el-button>\r\n            </el-popover>\r\n          </div>\r\n          <div class=\"infoContent\">\r\n            <div style=\"border: 1px solid gray;border-right: none;width:100%;height: 100%;display: flex; flex-direction: row;justify-content: start; align-items: center;\">\r\n              <div style=\"background-color: black;border: 1px solid gray;border-right: none;width:50%;height: 100%;display: flex; flex-direction: row;justify-content: start; align-items: center;\">\r\n                &emsp;&emsp;\r\n                <p style=\"font-family: 幼圆,serif; font-size: medium;color: white;\">{{inviteCode}}</p>\r\n              </div>\r\n              <div style=\"border: 1px solid gray;border-right: none;width:50%;height: 100%;display: flex; flex-direction: row;justify-content: start; align-items: center;\">\r\n                &emsp;&emsp;输入对方邀请码：\r\n                <el-tooltip class=\"item\" effect=\"dark\" content=\"输入后按Enter键确认\" placement=\"top\">\r\n                  <input type=\"text\" ref=\"othersInviteCode\" style=\"height: 55%;width: 55%;border-radius: 4px;border: 1px #0b007e solid;\" @keyup.enter=\"inputInviteCode()\"/>\r\n                </el-tooltip>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div v-show=\"!isLogin\" id=\"noInfoShow\">\r\n      <img src=\"/static/img/userCenterBG.png\" style=\"width: 28%\">\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"P_UserCenter\",\r\n  data(){\r\n    return {\r\n      isLogin: true,\r\n      uname: \"\",\r\n      uid: this.getUID(),\r\n      rank: 1,\r\n      registerTime: \"\",\r\n      workPlace: \"\",\r\n      department: \"\",\r\n      competent: \"\",\r\n      leftTimes: \"\",\r\n      totalTimes: \"\",\r\n      expiresTime: \"\",\r\n      inviteCode: \"\",\r\n      isChangeUName: false,\r\n      isChangeAdditionInfo: false,\r\n      isChangePWD: false,\r\n      pwdForm:{\r\n        oldPwd: \"\",\r\n        newPwd: \"\",\r\n        checkPwd: \"\",\r\n      },\r\n    }\r\n  },\r\n  computed:{\r\n    headerIconSrc(){\r\n      if (this.rank === 1){\r\n        return \"/static/img/normalUser.png\";\r\n      }\r\n      else{\r\n        return \"/static/img/superUser.png\";\r\n      }\r\n    },\r\n    headerFont(){\r\n      if (this.rank === 1){\r\n        return \"headerNormalFont\";\r\n      }\r\n      else{\r\n        return \"headerSuperFont\";\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.getUserCenterInfo();\r\n  },\r\n  methods:{\r\n    getCookie(objName){//获取指定名称的cookie的值\r\n      const arrStr = document.cookie.split(\"; \");\r\n      for(let i = 0; i < arrStr.length; i ++){\r\n        const temp = arrStr[i].split(\"=\");\r\n        if(temp[0] === objName) return temp[1];\r\n      }\r\n      return null;\r\n    },\r\n    getToken(){\r\n      return this.getCookie(\"NBI_token\");\r\n    },\r\n    getUID(){\r\n      return this.getCookie(\"NBI_UID\");\r\n    },\r\n    submitForm() {\r\n      if (this.pwdForm.newPwd === \"\" || this.pwdForm.checkPwd === \"\" || this.pwdForm.oldPwd === \"\"){\r\n        this.$message({\r\n          showClose: true,\r\n          message: '您必须输入原密码和新密码',\r\n          type: 'error',\r\n        });\r\n        return;\r\n      }\r\n      if (this.pwdForm.newPwd !== this.pwdForm.checkPwd){\r\n        this.$message({\r\n          showClose: true,\r\n          message: '您前后输入的新密码不一致',\r\n          type: 'error',\r\n        });\r\n        return;\r\n      }\r\n      let changePwdForm = new FormData();\r\n      changePwdForm.append(\"token\", this.getToken());\r\n      changePwdForm.append(\"uid\", this.getUID());\r\n      changePwdForm.append(\"oldPwd\", this.pwdForm.oldPwd);\r\n      changePwdForm.append(\"newPwd\", this.pwdForm.newPwd);\r\n      this.$axios.post(\"/NBI/User/uploadNewPwd/\",changePwdForm, {\r\n         headers: {'Content-Type': 'multipart/form-data'}\r\n      }).then((response)=>{\r\n        if (response.data === 1){\r\n          this.$message({\r\n            showClose: true,\r\n            message: '您的账号状态错误！',\r\n            type: 'error',\r\n          });\r\n        }\r\n        else if(response.data === 2){\r\n          this.$message({\r\n            showClose: true,\r\n            message: '原始密码错误，修改失败！',\r\n            type: 'error',\r\n          });\r\n          this.resetForm();\r\n        }\r\n        else if (response.data === 3){\r\n          this.$message({\r\n            showClose: true,\r\n            message: '新密码设置成功',\r\n            type: 'success',\r\n          });\r\n          this.isChangePWD = false;\r\n          this.resetForm();\r\n        }\r\n      });\r\n    },\r\n    resetForm() {\r\n      this.pwdForm.oldPwd = \"\";\r\n      this.pwdForm.newPwd = \"\";\r\n      this.pwdForm.checkPwd = \"\";\r\n      this.$refs.pwdForm.clearValidate();\r\n    },\r\n    inputInviteCode(){\r\n      // 可以反复赠送的问题还没有解决\r\n      let inviteCodeForm = new FormData();\r\n      inviteCodeForm.append(\"token\", this.getToken());\r\n      inviteCodeForm.append(\"uid\", this.getUID());\r\n      inviteCodeForm.append(\"inviteCode\", this.$refs.othersInviteCode.value);\r\n      this.$axios.post(\"/NBI/User/inputInviteCode/\",inviteCodeForm, {\r\n         headers: {'Content-Type': 'multipart/form-data'}\r\n      }).then((response)=>{\r\n        if (response.data === 1){\r\n          this.$message({\r\n            showClose: true,\r\n            message: '邀请码激活成功！已经为对方增加30天超级用户权限！',\r\n            type: 'success',\r\n          });\r\n        }\r\n        else if (response.data === -1){\r\n          this.$message({\r\n            showClose: true,\r\n            message: '您已注册超过24小时，不能赠送',\r\n            type: 'error',\r\n          });\r\n        }\r\n        else if (response.data === -2){\r\n          this.$message({\r\n            showClose: true,\r\n            message: '找不到目标用户，请检查您的邀请码是否正确',\r\n            type: 'error',\r\n          });\r\n        }\r\n        else if (response.data === -3){\r\n          this.$message({\r\n            showClose: true,\r\n            message: '不能给自己赠送哦',\r\n            type: 'error',\r\n          });\r\n        }\r\n        else if (response.data === -4){\r\n          this.$message({\r\n            showClose: true,\r\n            message: '您已经激活过了，一个账号仅可一次赠送，但可以多次接受赠送',\r\n            type: 'error',\r\n          });\r\n        }\r\n      });\r\n    },\r\n    uploadNewUName(){\r\n      this.isChangeUName = false;\r\n      let changeUnameForm = new FormData();\r\n      changeUnameForm.append(\"token\", this.getToken());\r\n      changeUnameForm.append(\"uid\", this.getUID());\r\n      this.uname = document.getElementById(\"newUName\").value;\r\n      changeUnameForm.append(\"name\",this.uname);\r\n      this.$axios.post(\"/NBI/User/uploadNewUName/\",changeUnameForm, {\r\n         headers: {'Content-Type': 'multipart/form-data'}\r\n      }).then((response)=>{\r\n        if (response.data===1){\r\n          this.$message({\r\n            showClose: true,\r\n            message: '您的账号状态错误！',\r\n            type: 'error',\r\n          });\r\n        }else{\r\n          this.$message({\r\n            showClose: true,\r\n            message: '修改用户名成功！',\r\n            type: 'success',\r\n          });\r\n          this.$bus.$emit('changeStatus', {status: true, uname: this.uname});\r\n        }\r\n      });\r\n    },\r\n    uploadNewAdditionalInfo(){\r\n      this.isChangeAdditionInfo = false;\r\n      let newAddInfo = new FormData();\r\n      newAddInfo.append(\"token\", this.getToken());\r\n      newAddInfo.append(\"uid\", this.getUID());\r\n      newAddInfo.append(\"workPlace\", this.$refs.workPlaceInput.value);\r\n      newAddInfo.append(\"department\", this.$refs.departmentInput.value);\r\n      newAddInfo.append(\"competent\", this.$refs.competentInput.value);\r\n      this.$axios.post(\"/NBI/User/uploadNewAddInfo/\",newAddInfo, {\r\n         headers: {'Content-Type': 'multipart/form-data'}\r\n      }).then((response)=>{\r\n        if (response.data===1){\r\n          this.$message({\r\n            showClose: true,\r\n            message: '您的账号状态错误！',\r\n            type: 'error',\r\n          });\r\n        }else{\r\n          this.$message({\r\n            showClose: true,\r\n            message: '修改附加信息成功！',\r\n            type: 'success',\r\n          });\r\n          this.workPlace = response.data.workPlace;\r\n          this.department = response.data.department;\r\n          this.competent = response.data.competent;\r\n        }\r\n      });\r\n    },\r\n    getUserCenterInfo(){\r\n      let getUserInfoForm = new FormData();\r\n      getUserInfoForm.append(\"token\", this.getToken());\r\n      getUserInfoForm.append(\"uid\", this.getUID());\r\n      let config = {\r\n         headers: {'Content-Type': 'multipart/form-data'}\r\n      };\r\n      this.$axios.post(\"/NBI/User/getUserInfo/\",getUserInfoForm, config).then((response)=>{\r\n        // console.log(response)\r\n        if (response.data===1){\r\n          this.isLogin = false;\r\n          this.$message({\r\n            showClose: true,\r\n            message: '没有找到您的用户信息，您可能是没有登录或通信不畅',\r\n            type: 'error'\r\n          });\r\n        }else{\r\n          this.isLogin = true;\r\n          this.uname = response.data.name;\r\n          this.rank = response.data.rank;\r\n          this.registerTime = response.data.registerTime;\r\n          this.workPlace = response.data.workPlace;\r\n          this.department = response.data.department;\r\n          this.competent = response.data.competent;\r\n          this.leftTimes = response.data.TIMES_generate;\r\n          this.totalTimes = response.data.SUM_generate;\r\n          this.expiresTime = response.data.expiresTime;\r\n          this.inviteCode = response.data.inviteCode;\r\n        }\r\n      });\r\n    },\r\n    userLogOut(){\r\n      // 注销\r\n      let logoutForm = new FormData();\r\n      logoutForm.append(\"token\", this.getToken());\r\n      logoutForm.append(\"uid\", this.getUID());\r\n      this.$axios.post(\"/NBI/User/logout/\",logoutForm, {\r\n         headers: {'Content-Type': 'multipart/form-data'}\r\n      }).then((response)=>{\r\n        console.log(response)\r\n        if (response.data === 1){\r\n          this.$message({\r\n            showClose: true,\r\n            message: '注销失败，您的账号状态错误！',\r\n            type: 'error'\r\n          });\r\n        }\r\n        else if (response.data === 2){\r\n          this.$message({\r\n            showClose: true,\r\n            message: '您已注销',\r\n            type: 'warning',\r\n          });\r\n          this.isLogin = false;\r\n          this.$bus.$emit('changeStatus', {status: false, uname: \"\"});\r\n        }\r\n      })\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n#userCenterPageContainer{\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n#userCenterInner{\r\n  width: 75%;\r\n  height: 90%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n}\r\n#noInfoShow{\r\n  width: 75%;\r\n  height: 90%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n#userCenterHeader{\r\n  height: 20%;\r\n  width: 100%;\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: center;\r\n  align-items: center;\r\n  border-bottom: 1px solid #07004f;\r\n}\r\n#userCenterInfo{\r\n  height: 77%;\r\n  width: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n}\r\n#userCenterHeader_icon{\r\n  height: 80%;\r\n  border-radius: 5px;\r\n  border: 1px #07004f solid;\r\n}\r\n.headerSuperFont{\r\n  color: goldenrod;\r\n  font-family: 幼圆,serif;\r\n}\r\n.headerNormalFont{\r\n  color: gray;\r\n  font-family: 幼圆,serif;\r\n}\r\n#headerNameFont{\r\n  color: #07004f;\r\n  font-family: \"Droid Sans Mono\", \"DejaVu Sans Mono\", monospace;\r\n  font-weight: bolder;\r\n  font-size: x-large;\r\n  cursor: pointer;\r\n  transition: 0.3s ease;\r\n}\r\n#headerNameFont:hover{\r\n  color: #0b007e;\r\n}\r\n#logOutBtn{\r\n  width: 25%;\r\n  margin-left: 4%;\r\n  height: 40%;\r\n  border: 2px solid #ff4b4b;\r\n  color: #0b007e;\r\n  font-family: \"Droid Sans Mono\", \"DejaVu Sans Mono\", monospace;\r\n  margin-right: 5%;\r\n  transition: 0.3s ease;\r\n  border-radius: 5px;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  font-size: small;\r\n}\r\n#logOutBtn:hover{\r\n  cursor: pointer;\r\n  background-color: red;\r\n  color: white;\r\n}\r\n#changePWDBtn{\r\n  width: 25%;\r\n  margin-left: 2%;\r\n  height: 40%;\r\n  border: 2px solid #006c00;\r\n  color: #0b007e;\r\n  font-family: \"Droid Sans Mono\", \"DejaVu Sans Mono\", monospace;\r\n  transition: 0.3s ease;\r\n  border-radius: 5px;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  font-size: small;\r\n}\r\n#changePWDBtn:hover{\r\n  cursor: pointer;\r\n  background-color: #00ce02;\r\n  color: white;\r\n}\r\n.changeBtn{\r\n  margin-left: 10px;\r\n  cursor:pointer;\r\n  width: 20px;\r\n  height: 20px;\r\n  transition: 0.3s ease;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n.changeBtn:hover{\r\n  background-color: gray;\r\n}\r\n.infoTitle{\r\n  width: 24%;\r\n  height: 100%;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  font-weight: bolder;\r\n  font-family: 幼圆,serif;\r\n}\r\n.infoContent{\r\n  width: 76%;\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: start;\r\n  font-family: 幼圆,serif;\r\n}\r\n.fontLink {\r\n  font-size: small;\r\n  font-family: 幼圆, serif;\r\n  transition: 0.3s ease;\r\n  color: #1122AA;\r\n  cursor: pointer;\r\n}\r\n.fontLink:hover{\r\n  color: #2e46ff;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}