{"ast":null,"code":"export default {\n  name: \"singleImageProcess_imageSendPart\",\n\n  data() {\n    return {\n      isUploaded: false,\n      uploadStatus_class: \"uploadStatus_red\",\n      blueImageChoose: false,\n      greenImageChoose: false,\n      additionInfo: {\n        sampleName: \"\",\n        part: \"\",\n        part_other: \"\",\n        remark: \"\"\n      },\n      part_Other: false,\n      part_diagnose: false\n    };\n  },\n\n  mounted() {\n    this.$bus.$on('sendUploadedInfoToGet', () => {\n      this.$bus.$emit(\"getUploadedInfo\", this.isUploaded);\n    });\n  },\n\n  beforeDestroy() {\n    this.$bus.$off(\"sendUploadedInfoToGet\");\n  },\n\n  methods: {\n    // cookie\n    getCookie(objName) {\n      //获取指定名称的cookie的值\n      const arrStr = document.cookie.split(\"; \");\n\n      for (let i = 0; i < arrStr.length; i++) {\n        const temp = arrStr[i].split(\"=\");\n        if (temp[0] === objName) return temp[1];\n      }\n\n      return null;\n    },\n\n    getToken() {\n      return this.getCookie(\"NBI_token\");\n    },\n\n    getUID() {\n      return this.getCookie(\"NBI_UID\");\n    },\n\n    uploadNewImage() {\n      if (!this.greenImageChoose || !this.blueImageChoose) {\n        alert(\"必须选择想要上传的原图片\");\n        return;\n      }\n\n      let uploadForm = new FormData(); // 图片数据\n\n      uploadForm.append(\"blueImage\", document.getElementById(\"blueImageButton\").files[0]);\n      uploadForm.append(\"greenImage\", document.getElementById(\"greenImageButton\").files[0]);\n      uploadForm.append(\"whiteImage\", document.getElementById(\"whiteImageButton\").files[0]); // 身份识别数据\n\n      uploadForm.append(\"uid\", this.getUID());\n      uploadForm.append(\"token\", this.getToken()); // 图片附加数据\n\n      uploadForm.append(\"sampleName\", this.additionInfo.sampleName);\n      uploadForm.append(\"remark\", this.additionInfo.remark);\n      const part = this.additionInfo.part === \"其他\" ? this.additionInfo.part_other : this.additionInfo.part;\n      uploadForm.append(\"part\", part);\n      const chooseList = document.getElementsByName(\"addInfo_diagnoseBefore_c\"); // 使用字符串数组，用于存放选择好了的数据\n\n      const chooseResult = [];\n\n      for (let i = 0; i < chooseList.length; i++) {\n        if (chooseList[i].selected === true) {\n          if (chooseList[i].value !== \"其他\") {\n            chooseResult.push(chooseList[i].value); //这个是获取多选框中的值\n          } else {\n            chooseResult.push(this.$refs.addInfo_diagnoseBefore_other.value); //这个是获取多选框中的值\n          }\n        }\n      }\n\n      uploadForm.append(\"diagnoseBefore\", chooseResult);\n      let config = {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      };\n      this.$refs.uploadStatus.innerText = \"上传中\";\n      this.uploadStatus_class = \"uploadStatus_yellow\";\n      this.$refs.uploadBtn.disabled = true;\n      this.$axios.post(\"/NBI/Image/upload/\", uploadForm, config).then(response => {\n        if (response.data === 1) {\n          alert(\"登录状态错误！请重新登录。\");\n          this.$refs.uploadStatus.innerText = \"等待上传\";\n          this.uploadStatus_class = \"uploadStatus_red\";\n        } else if (response.data === 2) {\n          alert(\"您提交的图片为空，请检查！\");\n          this.$refs.uploadStatus.innerText = \"等待上传\";\n          this.uploadStatus_class = \"uploadStatus_red\";\n        } else if (response.data === 3) {\n          alert(\"图片存储错误，目前仅支持常见图片格式。\");\n          this.$refs.uploadStatus.innerText = \"等待上传\";\n          this.uploadStatus_class = \"uploadStatus_red\";\n        } else {\n          const imageShow_blue = this.$refs.imageShow_blue;\n          imageShow_blue.className = \"uploadImageShow\";\n          imageShow_blue.src = \"/static/Data/Blue/\" + response.data.imageBlue;\n          const imageShow_green = this.$refs.imageShow_green;\n          imageShow_green.className = \"uploadImageShow\";\n          imageShow_green.src = \"/static/Data/Green/\" + response.data.imageGreen;\n\n          if (response.data.imageWhite !== null) {\n            const imageShow_white = this.$refs.imageShow_white;\n            imageShow_white.className = \"uploadImageShow\";\n            imageShow_white.src = \"/static/Data/White/\" + response.data.imageWhite;\n          }\n\n          this.$refs.uploadStatus.innerText = \"已上传\";\n          this.uploadStatus_class = \"uploadStatus_green\";\n          this.isUploaded = true;\n        }\n\n        this.$refs.uploadBtn.disabled = false;\n      });\n    },\n\n    chooseLastImage() {\n      let getLastUploadImageForm = new FormData(); // 身份识别数据\n\n      getLastUploadImageForm.append(\"uid\", this.getUID());\n      getLastUploadImageForm.append(\"token\", this.getToken());\n      let config = {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      };\n      this.$axios.post(\"/NBI/Image/chooseLastImage/\", getLastUploadImageForm, config).then(response => {\n        if (response.data === 2) {\n          alert(\"登录状态错误！请重新登录。\");\n        } else if (response.data === 1) {\n          alert(\"未发现上次上传的图片\");\n        } else {\n          const imageShow_blue = this.$refs.imageShow_blue;\n          imageShow_blue.className = \"uploadImageShow\";\n          imageShow_blue.src = \"/static/Data/Blue/\" + response.data.imageBlue;\n          const imageShow_green = this.$refs.imageShow_green;\n          imageShow_green.className = \"uploadImageShow\";\n          imageShow_green.src = \"/static/Data/Green/\" + response.data.imageGreen;\n\n          if (response.data.imageWhite !== null) {\n            const imageShow_white = this.$refs.imageShow_white;\n            imageShow_white.className = \"uploadImageShow\";\n            imageShow_white.src = \"/static/Data/White/\" + response.data.imageWhite;\n          }\n\n          this.additionInfo.sampleName = response.data.sampleName;\n          this.additionInfo.remark = response.data.remark;\n          this.isUploaded = true;\n        }\n      });\n    },\n\n    addInfoPartChange() {\n      const choose = document.getElementById(\"addInfo_bodyPart\").value;\n      this.part_Other = choose === \"其他\";\n    },\n\n    addInfoDiagnoseBeforeChange() {\n      const chooseList = document.getElementsByName(\"addInfo_diagnoseBefore_c\"); // 使用字符串数组，用于存放选择好了的数据\n\n      const chooseResult = new Array(chooseList.length);\n\n      for (let i = 0; i < chooseList.length; i++) {\n        if (chooseList[i].selected === true) {\n          chooseResult[i] = chooseList[i].value; //这个是获取多选框中的值\n        }\n      }\n\n      this.part_diagnose = chooseResult[5] !== undefined;\n    },\n\n    chooseBlueImage() {\n      this.blueImageChoose = true;\n      this.$refs.blueImageChooseBtn.click();\n    },\n\n    chooseGreenImage() {\n      this.greenImageChoose = true;\n      this.$refs.greenImageChooseBtn.click();\n    },\n\n    chooseWhiteImage() {\n      this.$refs.whiteImageChooseBtn.click();\n    },\n\n    getFileName(o) {\n      const pos = o.lastIndexOf(\"\\\\\");\n      return o.substring(pos + 1);\n    },\n\n    getFileType(o) {\n      const pos = o.lastIndexOf(\".\");\n      return o.slice(pos + 1, o.length);\n    },\n\n    blueImageShowChange() {\n      const imageShow = this.$refs.imageShow_blue;\n      imageShow.className = \"uploadIcon\";\n      const blue_input = this.$refs.blueImageChooseBtn;\n      this.$refs.blueImageShowBtn.innerText = \"选择蓝色光源图片(415nm)\\n\" + this.getFileName(blue_input.value);\n      const fileType = this.getFileType(blue_input.value);\n\n      if (fileType === \"jpg\" || fileType === \"JPG\" || fileType === \"jpeg\") {\n        const file = blue_input.files[0]; // 获取input上传的图片数据;\n\n        let read = new FileReader(); // 创建FileReader对像;\n\n        read.readAsDataURL(file); // 调用readAsDataURL方法读取文件;\n\n        read.onload = function () {\n          // 拿到读取结果;\n          imageShow.src = read.result;\n        };\n\n        imageShow.className = \"uploadImageShow\";\n      } else {\n        imageShow.src = \"/static/unknownImageTypeIcon.png\";\n      }\n    },\n\n    greenImageShowChange() {\n      const imageShow = this.$refs.imageShow_green;\n      imageShow.className = \"uploadIcon\";\n      const green_input = this.$refs.greenImageChooseBtn;\n      this.$refs.greenImageShowBtn.innerText = \"选择绿色光源图片(540nm)\\n\" + this.getFileName(green_input.value);\n      const fileType = this.getFileType(green_input.value);\n\n      if (fileType === \"jpg\" || fileType === \"JPG\" || fileType === \"jpeg\") {\n        const file = green_input.files[0]; // 获取input上传的图片数据;\n\n        let read = new FileReader(); // 创建FileReader对像;\n\n        read.readAsDataURL(file); // 调用readAsDataURL方法读取文件;\n\n        read.onload = function () {\n          // 拿到读取结果;\n          imageShow.src = read.result;\n        };\n\n        imageShow.className = \"uploadImageShow\";\n      } else {\n        imageShow.src = \"/static/unknownImageTypeIcon.png\";\n      }\n    },\n\n    whiteImageShowChange() {\n      const imageShow = this.$refs.imageShow_white;\n      imageShow.className = \"uploadIcon\";\n      const white_input = this.$refs.whiteImageChooseBtn;\n      this.$refs.whiteImageShowBtn.innerText = \"选择白色光源图片(非必须)\\n\" + this.getFileName(white_input.value);\n      const fileType = this.getFileType(white_input.value);\n\n      if (fileType === \"jpg\" || fileType === \"JPG\" || fileType === \"jpeg\") {\n        const file = white_input.files[0]; // 获取input上传的图片数据;\n\n        let read = new FileReader(); // 创建FileReader对像;\n\n        read.readAsDataURL(file); // 调用readAsDataURL方法读取文件;\n\n        read.onload = function () {\n          // 拿到读取结果;\n          imageShow.src = read.result;\n        };\n\n        imageShow.className = \"uploadImageShow\";\n      } else {\n        imageShow.src = \"/static/unknownImageTypeIcon.png\";\n      }\n    }\n\n  }\n};","map":{"version":3,"mappings":"AAiHA;EACAA,wCADA;;EAEAC;IACA;MACAC,iBADA;MAEAC,sCAFA;MAGAC,sBAHA;MAIAC,uBAJA;MAKAC;QACAC,cADA;QAEAC,QAFA;QAGAC,cAHA;QAIAC;MAJA,CALA;MAWAC,iBAXA;MAYAC;IAZA;EAcA,CAjBA;;EAkBAC;IACA;MACA;IACA,CAFA;EAGA,CAtBA;;EAuBAC;IACA;EACA,CAzBA;;EA0BAC;IACA;IACAC;MAAA;MACA;;MACA;QACA;QACA;MACA;;MACA;IACA,CATA;;IAUAC;MACA;IACA,CAZA;;IAaAC;MACA;IACA,CAfA;;IAgBAC;MACA;QACAC;QACA;MACA;;MACA,gCALA,CAMA;;MACAC;MACAA;MACAA,sFATA,CAUA;;MACAA;MACAA,4CAZA,CAaA;;MACAA;MACAA;MACA;MACAA;MACA,0EAlBA,CAmBA;;MACA;;MACA;QACA;UACA;YACAC,uCADA,CACA;UACA,CAFA,MAGA;YACAA,iEADA,CACA;UACA;QACA;MACA;;MACAD;MACA;QACAE;UAAA;QAAA;MADA;MAGA;MACA;MACA;MACA;QACA;UACAH;UACA;UACA;QACA,CAJA,MAKA;UACAA;UACA;UACA;QACA,CAJA,MAKA;UACAA;UACA;UACA;QACA,CAJA,MAKA;UACA;UACAI;UACAA;UACA;UACAC;UACAA;;UACA;YACA;YACAC;YACAA;UACA;;UACA;UACA;UACA;QACA;;QACA;MACA,CAjCA;IAkCA,CAxFA;;IAyFAC;MACA,4CADA,CAEA;;MACAC;MACAA;MACA;QACAL;UAAA;QAAA;MADA;MAGA;QACA;UACAH;QACA,CAFA,MAGA;UACAA;QACA,CAFA,MAGA;UACA;UACAI;UACAA;UACA;UACAC;UACAA;;UACA;YACA;YACAC;YACAA;UACA;;UACA;UACA;UAEA;QACA;MACA,CAxBA;IAyBA,CA1HA;;IA2HAG;MACA;MACA;IACA,CA9HA;;IA+HAC;MACA,0EADA,CAEA;;MACA;;MACA;QACA;UACAR,sCADA,CACA;QACA;MACA;;MACA;IACA,CAzIA;;IA0IAS;MACA;MACA;IACA,CA7IA;;IA8IAC;MACA;MACA;IACA,CAjJA;;IAkJAC;MACA;IACA,CApJA;;IAqJAC;MACA;MACA;IACA,CAxJA;;IAyJAC;MACA;MACA;IACA,CA5JA;;IA6JAC;MACA;MACAC;MACA;MACA;MACA;;MACA;QACA,iCADA,CACA;;QACA,4BAFA,CAEA;;QACAC,yBAHA,CAGA;;QACAA;UACA;UACAD;QACA,CAHA;;QAIAA;MACA,CATA,MASA;QACAA;MACA;IACA,CA/KA;;IAgLAE;MACA;MACAF;MACA;MACA;MACA;;MACA;QACA,kCADA,CACA;;QACA,4BAFA,CAEA;;QACAC,yBAHA,CAGA;;QACAA;UACA;UACAD;QACA,CAHA;;QAIAA;MACA,CATA,MASA;QACAA;MACA;IACA,CAlMA;;IAmMAG;MACA;MACAH;MACA;MACA;MACA;;MACA;QACA,kCADA,CACA;;QACA,4BAFA,CAEA;;QACAC,yBAHA,CAGA;;QACAA;UACA;UACAD;QACA,CAHA;;QAIAA;MACA,CATA,MASA;QACAA;MACA;IACA;;EArNA;AA1BA","names":["name","data","isUploaded","uploadStatus_class","blueImageChoose","greenImageChoose","additionInfo","sampleName","part","part_other","remark","part_Other","part_diagnose","mounted","beforeDestroy","methods","getCookie","getToken","getUID","uploadNewImage","alert","uploadForm","chooseResult","headers","imageShow_blue","imageShow_green","imageShow_white","chooseLastImage","getLastUploadImageForm","addInfoPartChange","addInfoDiagnoseBeforeChange","chooseBlueImage","chooseGreenImage","chooseWhiteImage","getFileName","getFileType","blueImageShowChange","imageShow","read","greenImageShowChange","whiteImageShowChange"],"sourceRoot":"src/components/singleImageProcess","sources":["singleImageProcess_imageSendPart.vue"],"sourcesContent":["<template>\r\n  <div id=\"imgPart\">\r\n    <div class=\"subTitle\">\r\n      <p style=\";width:40%;height: 50%;font-family: STHeiti;color: #363636;display: flex;justify-content: center;margin-left: 2%;\">图片上传（Image Upload）：</p>\r\n      <div style=\"width: 100%;height: 50%;display: flex;flex-direction: row;\">\r\n        <div id=\"uploadBtnContainer\">\r\n          <el-button icon=\"el-icon-upload2\" type=\"primary\" ref=\"uploadBtn\" @click=\"uploadNewImage()\" style=\"width: 90%;border-radius: 5px;font-size: small\">开始上传</el-button>\r\n        </div>\r\n        <div id=\"uploadStatus\">\r\n            <p ref=\"uploadStatus\" :class=\"uploadStatus_class\">等待上传</p>\r\n        </div>\r\n        <div id=\"chooseLastImageBtn\" @click=\"chooseLastImage()\">\r\n            <p>选择上次上传图片>>></p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"imgPart_inner\">\r\n      <div class=\"innerTitle\">\r\n          <p style=\"overflow: hidden;width:13%;font-family: 幼圆;color: #363636;display: flex;justify-content: flex-start;margin-left: 3%\">图片信息</p>\r\n          <p style=\"margin-left: 5%;color: red;font-family: 幼圆\">*必须</p>\r\n      </div>\r\n      <div id=\"imgSendContainer\">\r\n          <div id=\"imgSendPart_blue\" @click=\"chooseBlueImage()\">\r\n              <div style=\"width: 100%; height:96%; display: flex;justify-content: center\" id=\"blueImageShowFeild\">\r\n                  <img ref=\"imageShow_blue\" src=\"@/assets/uploadicon.png\" id=\"icon_blue\" class=\"uploadIcon\" alt=\"图片加载失败\">\r\n              </div>\r\n              <div style=\"width: 100%; height: 18%; margin-top: 0\">\r\n                  <div ref=\"blueImageShowBtn\" class=\"uploadButton\" id=\"blueImageButton_Show\" @click=\"chooseBlueImage()\">选择蓝色光源图片(415nm)</div>\r\n                  <!--这个提交按钮太丑了，隐藏-->\r\n                  <input ref=\"blueImageChooseBtn\" id=\"blueImageButton\" type=\"file\" style=\"margin-top: 400px\" @change=\"blueImageShowChange()\">\r\n              </div>\r\n          </div>\r\n          <div id=\"imgSendPart_green\" @click=\"chooseGreenImage()\">\r\n              <div style=\"width: 100%; height:96%; display: flex;justify-content: center\">\r\n                  <img ref=\"imageShow_green\" src=\"@/assets/uploadicon.png\" id=\"icon_green\" class=\"uploadIcon\" alt=\"图片加载失败\">\r\n              </div>\r\n              <div style=\"width: 100%; height: 18%; margin-top: 0\">\r\n                  <div ref=\"greenImageShowBtn\" class=\"uploadButton\" id=\"greenImageButton_Show\" @click=\"chooseGreenImage()\" style=\"background-color: rgba(49,143,63,0.4)\">选择绿色光源图片(540nm)</div>\r\n                  <input ref=\"greenImageChooseBtn\" id=\"greenImageButton\" type=\"file\" style=\"margin-top: 400px\" @change=\"greenImageShowChange()\">\r\n              </div>\r\n          </div>\r\n          <div id=\"imgSendPart_white\" @click=\"chooseWhiteImage()\">\r\n              <div style=\"width: 100%; height:96%; display: flex;justify-content: center\">\r\n                  <img ref=\"imageShow_white\" src=\"@/assets/uploadicon.png\" id=\"icon_white\" class=\"uploadIcon\" alt=\"图片加载失败\">\r\n              </div>\r\n              <div style=\"width: 100%; height: 18%; margin-top: 0\">\r\n                  <div ref=\"whiteImageShowBtn\" class=\"uploadButton\" id=\"whiteImageButton_Show\" @click=\"chooseWhiteImage()\" style=\"background-color: rgba(255, 255, 255, 0.4); color: black;border: 2px solid #323232;\">选择白色光源图片(非必须)</div>\r\n                  <input ref=\"whiteImageChooseBtn\" id=\"whiteImageButton\" type=\"file\" style=\"margin-top: 400px\" @change=\"whiteImageShowChange()\">\r\n              </div>\r\n          </div>\r\n      </div>\r\n      <div class=\"innerTitle\">\r\n          <p style=\"line-height:20px;width:10%;font-family: STHeiti;color: #363636;display: flex;justify-content: center;font-weight: bold;margin-left: 6%;\">附加信息</p>\r\n          <p style=\"margin-left: 5%;color: rgb(19, 124, 0);\">*非必须</p>\r\n      </div>\r\n      <div id=\"imgSend_addInfoContainer\">\r\n        <div style=\"width: 40%; margin-left: 5%;height: 100%; display: block;justify-content: left;\">\r\n            <div class=\"addInfo\">\r\n                <p class=\"addInfo_formLabel\">标本名称：</p>\r\n                <input v-model=\"additionInfo.sampleName\" class=\"addInfo_formInput\" id=\"addInfo_sampleName\" AUTOCOMPLETE=\"off\" type=\"text\" placeholder=\"    输入标本名称\"/>\r\n                <p style=\"color: red;width: 5%;text-align: center;\"></p>\r\n            </div>\r\n            <div id=\"addInfo_bodyPart_Container\" style=\"display: flex;flex-direction: column;\">\r\n                <div class=\"addInfo\">\r\n                    <p class=\"addInfo_formLabel\">    部位：</p>\r\n                    <select v-model=\"additionInfo.part\" class=\"addInfo_choose\" id=\"addInfo_bodyPart\" @change=\"addInfoPartChange()\">\r\n                        <option>    食管</option>\r\n                        <option>    胃</option>\r\n                        <option>    小肠</option>\r\n                        <option>    大肠</option>\r\n                        <option>    其他</option>\r\n                    </select>\r\n                    <p style=\"color: red;width: 5%;text-align: center;\"></p>\r\n                </div>\r\n                <div v-show=\"part_Other\"  class=\"addInfo\" id=\"addInfo_bodyPart_other_Container\">\r\n                  <p class=\"addInfo_formLabel\"></p>\r\n                  <input v-model=\"additionInfo.part_other\" class=\"addInfo_formInput\" id=\"addInfo_bodyPart_other\" AUTOCOMPLETE=\"off\" type=\"text\" placeholder=\"    输入其他标本部位名称\"/>\r\n                  <p style=\"color: red;width: 5%;text-align: center;\"></p>\r\n                </div>\r\n            </div>\r\n            <div class=\"addInfo\">\r\n                <p class=\"addInfo_formLabel\">        备注：</p>\r\n                <div style=\"width: 60%;height: 100px;display: flex;justify-content: center;align-items: center;overflow: hidden;\">\r\n                    <textarea v-model=\"additionInfo.remark\" style=\"font-family: Arial, Helvetica, sans-serif; font-size: 14px;height: 92%; width: 100%;resize: none;\" placeholder=\"    备注\"></textarea>\r\n                </div>\r\n                <p style=\"color: red;width: 5%;text-align: center;\"></p>\r\n            </div>\r\n        </div>\r\n        <div style=\"width: 50%; height: 100%; display: flex;flex-direction: column;\">\r\n            <div id=\"addInfo_diagnoseBefore_Container\" style=\"display: flex;flex-direction: column;\">\r\n                <div class=\"addInfo\">\r\n                    <p class=\"addInfo_formLabel\">术前诊断：<br>(可按住shift多选)</p>\r\n                    <select multiple=\"multiple\" style=\"width: 60%;height: 200px;\" id=\"addInfo_diagnoseBefore\" @change=\"addInfoDiagnoseBeforeChange()\">\r\n                        <option name=\"addInfo_diagnoseBefore_c\" class=\"addInfo_choose\" style=\"width: 100%; display: flex;align-items: center;justify-content: left;\">    早癌</option>\r\n                        <option name=\"addInfo_diagnoseBefore_c\" class=\"addInfo_choose\" style=\"width: 100%; display: flex;align-items: center;justify-content: left;\">    LGIN</option>\r\n                        <option name=\"addInfo_diagnoseBefore_c\" class=\"addInfo_choose\" style=\"width: 100%; display: flex;align-items: center;justify-content: left;\">    腺瘤</option>\r\n                        <option name=\"addInfo_diagnoseBefore_c\" class=\"addInfo_choose\" style=\"width: 100%; display: flex;align-items: center;justify-content: left;\">    SMT</option>\r\n                        <option name=\"addInfo_diagnoseBefore_c\" class=\"addInfo_choose\" style=\"width: 100%; display: flex;align-items: center;justify-content: left;\">    炎症</option>\r\n                        <option id=\"addInfo_diagnoseBefore_other_option\" name=\"addInfo_diagnoseBefore_c\" class=\"addInfo_choose\" style=\"width: 100%; display: flex;align-items: center;justify-content: left;\">    其他</option>\r\n                    </select>\r\n                </div>\r\n                <div v-show=\"part_diagnose\" class=\"addInfo\" id=\"addInfo_diagnoseBefore_other_Container\">\r\n                    <p class=\"addInfo_formLabel\"></p>\r\n                    <input ref=\"addInfo_diagnoseBefore_other\" class=\"addInfo_formInput\" AUTOCOMPLETE=\"off\" type=\"text\" placeholder=\"    输入其他早期诊断结论\"/>\r\n                </div>\r\n            </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"singleImageProcess_imageSendPart\",\r\n  data(){\r\n    return {\r\n      isUploaded: false,\r\n      uploadStatus_class: \"uploadStatus_red\",\r\n      blueImageChoose: false,\r\n      greenImageChoose: false,\r\n      additionInfo:{\r\n        sampleName: \"\",\r\n        part: \"\",\r\n        part_other: \"\",\r\n        remark: \"\",\r\n      },\r\n      part_Other: false,\r\n      part_diagnose: false,\r\n    }\r\n  },\r\n  mounted() {\r\n    this.$bus.$on('sendUploadedInfoToGet',()=>{\r\n      this.$bus.$emit(\"getUploadedInfo\",this.isUploaded);\r\n    })\r\n  },\r\n  beforeDestroy() {\r\n    this.$bus.$off(\"sendUploadedInfoToGet\");\r\n  },\r\n  methods:{\r\n    // cookie\r\n    getCookie(objName){//获取指定名称的cookie的值\r\n      const arrStr = document.cookie.split(\"; \");\r\n      for(let i = 0; i < arrStr.length; i ++){\r\n        const temp = arrStr[i].split(\"=\");\r\n        if(temp[0] === objName) return temp[1];\r\n      }\r\n      return null;\r\n    },\r\n    getToken(){\r\n      return this.getCookie(\"NBI_token\");\r\n    },\r\n    getUID(){\r\n      return this.getCookie(\"NBI_UID\");\r\n    },\r\n    uploadNewImage(){\r\n      if (!this.greenImageChoose || !this.blueImageChoose){\r\n        alert(\"必须选择想要上传的原图片\");\r\n        return;\r\n      }\r\n      let uploadForm = new FormData();\r\n      // 图片数据\r\n      uploadForm.append(\"blueImage\", document.getElementById(\"blueImageButton\").files[0]);\r\n      uploadForm.append(\"greenImage\", document.getElementById(\"greenImageButton\").files[0]);\r\n      uploadForm.append(\"whiteImage\", document.getElementById(\"whiteImageButton\").files[0]);\r\n      // 身份识别数据\r\n      uploadForm.append(\"uid\", this.getUID());\r\n      uploadForm.append(\"token\", this.getToken());\r\n      // 图片附加数据\r\n      uploadForm.append(\"sampleName\", this.additionInfo.sampleName);\r\n      uploadForm.append(\"remark\", this.additionInfo.remark);\r\n      const part = this.additionInfo.part === \"其他\"? this.additionInfo.part_other: this.additionInfo.part;\r\n      uploadForm.append(\"part\", part);\r\n      const chooseList = document.getElementsByName(\"addInfo_diagnoseBefore_c\");\r\n      // 使用字符串数组，用于存放选择好了的数据\r\n      const chooseResult = [];\r\n      for(let i = 0;i < chooseList.length;i++) {\r\n          if (chooseList[i].selected === true) {\r\n            if (chooseList[i].value !== \"其他\"){\r\n              chooseResult.push(chooseList[i].value);//这个是获取多选框中的值\r\n            }\r\n            else{\r\n              chooseResult.push(this.$refs.addInfo_diagnoseBefore_other.value);//这个是获取多选框中的值\r\n            }\r\n          }\r\n      }\r\n      uploadForm.append(\"diagnoseBefore\", chooseResult);\r\n      let config = {\r\n         headers: {'Content-Type': 'multipart/form-data'}\r\n      };\r\n      this.$refs.uploadStatus.innerText = \"上传中\";\r\n      this.uploadStatus_class = \"uploadStatus_yellow\";\r\n      this.$refs.uploadBtn.disabled = true;\r\n      this.$axios.post(\"/NBI/Image/upload/\",uploadForm, config).then((response) => {\r\n        if (response.data === 1){\r\n            alert(\"登录状态错误！请重新登录。\");\r\n            this.$refs.uploadStatus.innerText = \"等待上传\";\r\n            this.uploadStatus_class = \"uploadStatus_red\";\r\n        }\r\n        else if (response.data === 2){\r\n            alert(\"您提交的图片为空，请检查！\");\r\n            this.$refs.uploadStatus.innerText = \"等待上传\";\r\n            this.uploadStatus_class = \"uploadStatus_red\";\r\n        }\r\n        else if (response.data === 3){\r\n            alert(\"图片存储错误，目前仅支持常见图片格式。\");\r\n            this.$refs.uploadStatus.innerText = \"等待上传\";\r\n            this.uploadStatus_class = \"uploadStatus_red\";\r\n        }\r\n        else{\r\n          const imageShow_blue = this.$refs.imageShow_blue;\r\n          imageShow_blue.className = \"uploadImageShow\";\r\n          imageShow_blue.src = \"/static/Data/Blue/\"+response.data.imageBlue;\r\n          const imageShow_green = this.$refs.imageShow_green;\r\n          imageShow_green.className = \"uploadImageShow\";\r\n          imageShow_green.src = \"/static/Data/Green/\"+response.data.imageGreen;\r\n          if (response.data.imageWhite !== null){\r\n            const imageShow_white = this.$refs.imageShow_white;\r\n            imageShow_white.className = \"uploadImageShow\";\r\n            imageShow_white.src = \"/static/Data/White/\"+response.data.imageWhite;\r\n          }\r\n          this.$refs.uploadStatus.innerText = \"已上传\";\r\n          this.uploadStatus_class = \"uploadStatus_green\";\r\n          this.isUploaded = true;\r\n        }\r\n        this.$refs.uploadBtn.disabled = false;\r\n      });\r\n    },\r\n    chooseLastImage(){\r\n      let getLastUploadImageForm = new FormData();\r\n      // 身份识别数据\r\n      getLastUploadImageForm.append(\"uid\", this.getUID());\r\n      getLastUploadImageForm.append(\"token\", this.getToken());\r\n      let config = {\r\n         headers: {'Content-Type': 'multipart/form-data'}\r\n      };\r\n      this.$axios.post(\"/NBI/Image/chooseLastImage/\",getLastUploadImageForm, config).then((response) => {\r\n        if (response.data === 2){\r\n            alert(\"登录状态错误！请重新登录。\");\r\n        }\r\n        else if (response.data === 1){\r\n            alert(\"未发现上次上传的图片\");\r\n        }\r\n        else{\r\n          const imageShow_blue = this.$refs.imageShow_blue;\r\n          imageShow_blue.className = \"uploadImageShow\";\r\n          imageShow_blue.src = \"/static/Data/Blue/\"+response.data.imageBlue;\r\n          const imageShow_green = this.$refs.imageShow_green;\r\n          imageShow_green.className = \"uploadImageShow\";\r\n          imageShow_green.src = \"/static/Data/Green/\"+response.data.imageGreen;\r\n          if (response.data.imageWhite !== null){\r\n            const imageShow_white = this.$refs.imageShow_white;\r\n            imageShow_white.className = \"uploadImageShow\";\r\n            imageShow_white.src = \"/static/Data/White/\"+response.data.imageWhite;\r\n          }\r\n          this.additionInfo.sampleName = response.data.sampleName;\r\n          this.additionInfo.remark = response.data.remark;\r\n\r\n          this.isUploaded = true;\r\n        }\r\n      });\r\n    },\r\n    addInfoPartChange(){\r\n      const choose = document.getElementById(\"addInfo_bodyPart\").value;\r\n      this.part_Other = choose === \"其他\";\r\n    },\r\n    addInfoDiagnoseBeforeChange(){\r\n      const chooseList = document.getElementsByName(\"addInfo_diagnoseBefore_c\");\r\n      // 使用字符串数组，用于存放选择好了的数据\r\n      const chooseResult = new Array(chooseList.length);\r\n      for(let i = 0;i < chooseList.length;i++) {\r\n          if (chooseList[i].selected === true) {\r\n              chooseResult[i] = chooseList[i].value;//这个是获取多选框中的值\r\n          }\r\n      }\r\n      this.part_diagnose = chooseResult[5] !== undefined;\r\n    },\r\n    chooseBlueImage(){\r\n      this.blueImageChoose = true;\r\n      this.$refs.blueImageChooseBtn.click();\r\n    },\r\n    chooseGreenImage(){\r\n      this.greenImageChoose = true;\r\n      this.$refs.greenImageChooseBtn.click();\r\n    },\r\n    chooseWhiteImage(){\r\n      this.$refs.whiteImageChooseBtn.click();\r\n    },\r\n    getFileName(o){\r\n      const pos = o.lastIndexOf(\"\\\\\");\r\n      return o.substring(pos+1);\r\n    },\r\n    getFileType(o){\r\n      const pos = o.lastIndexOf(\".\");\r\n      return o.slice(pos+1, o.length);\r\n    },\r\n    blueImageShowChange(){\r\n      const imageShow = this.$refs.imageShow_blue;\r\n      imageShow.className = \"uploadIcon\";\r\n      const blue_input = this.$refs.blueImageChooseBtn;\r\n      this.$refs.blueImageShowBtn.innerText = \"选择蓝色光源图片(415nm)\\n\"+this.getFileName(blue_input.value);\r\n      const fileType = this.getFileType(blue_input.value);\r\n      if (fileType === \"jpg\" || fileType ===\"JPG\" || fileType===\"jpeg\"){\r\n        const file = blue_input.files[0]; // 获取input上传的图片数据;\r\n        let read = new FileReader(); // 创建FileReader对像;\r\n        read.readAsDataURL(file); // 调用readAsDataURL方法读取文件;\r\n        read.onload = function() {\r\n          // 拿到读取结果;\r\n          imageShow.src = read.result;\r\n        }\r\n        imageShow.className = \"uploadImageShow\";\r\n      }else{\r\n        imageShow.src = \"/static/unknownImageTypeIcon.png\";\r\n      }\r\n    },\r\n    greenImageShowChange(){\r\n      const imageShow = this.$refs.imageShow_green;\r\n      imageShow.className = \"uploadIcon\";\r\n      const green_input = this.$refs.greenImageChooseBtn;\r\n      this.$refs.greenImageShowBtn.innerText = \"选择绿色光源图片(540nm)\\n\"+this.getFileName(green_input.value);\r\n      const fileType = this.getFileType(green_input.value);\r\n      if (fileType === \"jpg\" || fileType ===\"JPG\" || fileType===\"jpeg\"){\r\n        const file = green_input.files[0]; // 获取input上传的图片数据;\r\n        let read = new FileReader(); // 创建FileReader对像;\r\n        read.readAsDataURL(file); // 调用readAsDataURL方法读取文件;\r\n        read.onload = function() {\r\n          // 拿到读取结果;\r\n          imageShow.src = read.result;\r\n        }\r\n        imageShow.className = \"uploadImageShow\";\r\n      }else{\r\n        imageShow.src = \"/static/unknownImageTypeIcon.png\";\r\n      }\r\n    },\r\n    whiteImageShowChange(){\r\n      const imageShow = this.$refs.imageShow_white;\r\n      imageShow.className = \"uploadIcon\";\r\n      const white_input = this.$refs.whiteImageChooseBtn;\r\n      this.$refs.whiteImageShowBtn.innerText = \"选择白色光源图片(非必须)\\n\"+this.getFileName(white_input.value);\r\n      const fileType = this.getFileType(white_input.value);\r\n      if (fileType === \"jpg\" || fileType ===\"JPG\" || fileType===\"jpeg\"){\r\n        const file = white_input.files[0]; // 获取input上传的图片数据;\r\n        let read = new FileReader(); // 创建FileReader对像;\r\n        read.readAsDataURL(file); // 调用readAsDataURL方法读取文件;\r\n        read.onload = function() {\r\n          // 拿到读取结果;\r\n          imageShow.src = read.result;\r\n        }\r\n        imageShow.className = \"uploadImageShow\";\r\n      }else{\r\n        imageShow.src = \"/static/unknownImageTypeIcon.png\";\r\n      }\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n#imgPart{\r\n  width: 100%;\r\n  /* height: 100%; */\r\n  overflow: hidden;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  flex-direction: column;\r\n}\r\n\r\n.subTitle{\r\n    display: flex;\r\n    align-items: flex-start;\r\n    flex-direction: column;\r\n    justify-content: left;\r\n    width: 100%;\r\n    height: 100px;\r\n    border-bottom: 1px #cbcbcb solid;\r\n    overflow: hidden;\r\n}\r\n#uploadBtnContainer{\r\n    width: 32%;\r\n    height: 70%;\r\n    margin-left: 3%;\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: start;\r\n    align-items: center;\r\n    overflow: hidden;\r\n}\r\n#chooseLastImageBtn{\r\n    margin-left: 20%;\r\n    width: 30%;\r\n    height: 70%;\r\n    cursor: pointer;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    font-family: Arial, Helvetica, sans-serif;\r\n    color: rgb(37, 70, 255);\r\n    transition: 0.3s ease;\r\n    font-size: small;\r\n    border:rgb(37, 70, 255) 1px solid ;\r\n    border-radius: 3px;\r\n}\r\n\r\n#chooseLastImageBtn:hover{\r\n    color: rgb(91, 115, 255);\r\n    border:rgb(91, 115, 255) 1px solid ;\r\n}\r\n\r\n#uploadStatus{\r\n    margin-left: 0%;\r\n    width: 18%;\r\n    height: 70%;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: start;\r\n}\r\n.uploadStatus_red{\r\n  font-family: 幼圆;\r\n  font-weight: bold;\r\n  color: rgb(217, 8, 8);\r\n}\r\n.uploadStatus_yellow{\r\n  font-family: 幼圆;\r\n  font-weight: bold;\r\n  color: rgb(255, 183, 82);\r\n}\r\n.uploadStatus_green{\r\n  font-family: 幼圆;\r\n  font-weight: bold;\r\n  color: rgb(34, 255, 0);\r\n}\r\n\r\n.imgPart_inner{\r\n    width: 100%;\r\n    display: flex;\r\n    justify-content: center;\r\n    flex-direction: column;\r\n}\r\n\r\n#imgSendContainer{\r\n    display: flex;\r\n    flex-direction: row;\r\n    width: 100%;\r\n    height: 130px;\r\n    justify-content: start;\r\n    align-items: center;\r\n}\r\n\r\n#imgSendPart_blue{\r\n    width: 30%;\r\n    height: 90%;\r\n    background-color: rgba(154, 198, 255, 0.95);\r\n    border: 3px solid black;\r\n    align-content: center;\r\n    border-radius: 5px;\r\n    transition: 0.3s;\r\n    overflow: hidden;\r\n    margin-right: 2%;\r\n    margin-left: 3%;\r\n}\r\n#imgSendPart_blue:hover{\r\n    background-color: rgba(154, 198, 255, 0.5);\r\n}\r\n\r\n#imgSendPart_green{\r\n    width: 28%;\r\n    height: 90%;\r\n    background-color: rgba(154, 255, 171, 0.95);\r\n    /* border-radius: 25px; */\r\n    border: 2px dashed rgba(170, 170, 170, 0.9);\r\n    align-content: center;\r\n    transition: 0.3s;\r\n    overflow: hidden;\r\n    margin-right: 2%;\r\n}\r\n\r\n#imgSendPart_green:hover{\r\n    background-color: rgba(154, 255, 171, 0.5);\r\n}\r\n\r\n#imgSendPart_white{\r\n    width: 28%;\r\n    height: 90%;\r\n    background-color: rgba(242, 242, 242, 0.05);\r\n    /* border-radius: 25px; */\r\n    border: 2px dashed rgba(170, 170, 170, 0.9);\r\n    align-content: center;\r\n    transition: 0.3s;\r\n    overflow: hidden;\r\n}\r\n\r\n#imgSendPart_white:hover{\r\n    background-color: rgba(228, 228, 228, 0.15);\r\n}\r\n\r\n.innerTitle{\r\n    display: flex;\r\n    align-items: center;\r\n    flex-direction: row;\r\n    justify-content: left;\r\n    width: 100%;\r\n    height: 30px;\r\n    overflow: hidden;\r\n}\r\n\r\n.uploadButton {\r\n    transition: 0.1s ease;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    flex: 1 1 auto;\r\n    height: 30%;\r\n    margin-left: 10px;\r\n    margin-right: 10px;\r\n    margin-top: -55px;\r\n    padding: 20px;\r\n    border: 2px solid #f7f7f7;\r\n    border-radius: 5px;\r\n    text-align: center;\r\n    position: relative;\r\n    overflow: hidden;\r\n    font-family: STHeiti;\r\n    color: white;\r\n    background-color: rgba(0, 112, 221, 0.4);\r\n}\r\n.uploadButton:after {\r\n    position: absolute;\r\n    transition: 0.3s;\r\n    content: \"\";\r\n    width: 0;\r\n    left: 50%;\r\n    bottom: 0;\r\n    height: 3px;\r\n    background: #ff906c;\r\n}\r\n.uploadButton:hover {\r\n    cursor: pointer;\r\n}\r\n.uploadButton:hover:after {\r\n    width: 100%;\r\n    left: 0;\r\n}\r\n\r\n.uploadIcon{\r\n    height: 60%;\r\n    margin-top: 5%;\r\n}\r\n/*当展示上传的图片时显示这个样式*/\r\n.uploadImageShow{\r\n    height: 100%;\r\n}\r\n\r\n#imgSend_addInfoContainer{\r\n    display: flex;\r\n    flex-direction: row;\r\n    margin-top: 30px;\r\n    width: 100%;\r\n    height: 280px;\r\n    justify-content: center;\r\n    align-items: center;\r\n}\r\n.addInfo{\r\n    display: flex;\r\n    flex-direction: row;\r\n    width: 90%;\r\n    justify-content: center;\r\n    align-items: center;\r\n}\r\n.addInfo_formLabel{\r\n\twidth: 30%;\r\n    height: 60px;\r\n\toverflow: hidden;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    margin: 0px;\r\n}\r\n.addInfo_formInput{\r\n\twidth: 60%;\r\n    height: 40px;\r\n\tdisplay: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    box-sizing: border-box;\r\n    text-align:left;\r\n    border-radius:4px;\r\n    border:1px solid #c8cccf;\r\n    color:#6a6f77;\r\n}\r\n.addInfo_choose{\r\n    width: 60%;\r\n    height: 40px;\r\n\tdisplay: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    box-sizing: border-box;\r\n    text-align:left;\r\n    border-radius:4px;\r\n    border:1px solid #c8cccf;\r\n    color:#6a6f77;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}